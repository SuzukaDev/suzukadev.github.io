{{/*  
Makes a shimmer/bright animation with position and scale animations.

Arguments:
text = (string) Text with the effect
time = (float) Animation time. Default: 2.4 (s)
delay = (float) Delay time for each char. Default: 0.05 (s)
blur = (int) Default: 12 (px)
color1 = Bright color
color2 = Secondary color (for the trail)
color1-light = Light version of Color 1 (if not defined it will use color1)
color2-light = Light version of Color 2 (if not defined it will use color2)
color1-dark =  Dark version of Color 1 (if not defined it will use color1)
color2-dark =  Dark version of Color 2 (if not defined it will use color2)
scale = (float) Scale animation. Default: 1.3
x = (int) X Displacement animation. Default: 0 (px)
y = (int) Y Displacement animation. Default: 0 (px)
z = (DEPRECATED) (int) Z Displacement animation Default: 0 (px)
font = (int (0,1,2)) 1 = Terminal font, 2 = Pixel art font. Default: 0 (do not change the original font)
*/}}

{{ $chars := split (.Get "text") "" }}
{{ $animation_time := float ((.Get "time") | default 2.4) }}
{{ $time_start_offset := ((.Get "time_offset") | default 0.0) }}
{{ $rawDelay := float ((.Get "delay") | default .05) }}
{{ $absDelay := math.Abs $rawDelay }}

{{ $color1 := ((.Get "color1") | default "white") }}
{{ $color2 := ((.Get "color2") | default "white") }}
{{ $color1light := ((.Get "color1-light") | default $color1) }}
{{ $color2light := ((.Get "color2-light") | default $color2) }}
{{ $color1dark := ((.Get "color1-dark") | default $color1) }}
{{ $color2dark := ((.Get "color2-dark") | default $color2) }}

{{ $font := .Get "font" | default 0 }}
{{ $top_css_class := "shimmer"}}
{{ if eq $font 1 }}
	{{ $top_css_class = printf "%s %s" $top_css_class "consolas" }}
{{ else if eq $font 2 }}
	{{ $top_css_class = printf "%s %s" $top_css_class "pixel-font" }}
{{ else if eq $font 3 }}
	{{ $top_css_class = printf "%s %s" $top_css_class "handwritten-font" }}
{{ end }}

{{/*  {{ $blur := ((.Get "blur") | default 12) }}  */}}
{{ $blur := .Get "blur" }}
{{ if eq $blur nil }}
  {{ $blur = 12 }}
{{ end }}
{{ $blur_property := printf "--shimmer-blur-pixels: %dpx" $blur }}

{{ $x := ((.Get "x") | default 0) }}
{{ $y := ((.Get "y") | default 0) }}
{{ $z := ((.Get "z") | default 0) }}

{{ $shimmer_c1 := printf "--shimmer-color-1:%s; --shimmer-color-1-light:%s; --shimmer-color-1-dark:%s" $color1 $color1light $color1dark}}
{{ $shimmer_c2 := printf "--shimmer-color-2:%s; --shimmer-color-2-light:%s; --shimmer-color-2-dark:%s" $color2 $color2light $color2dark}}


{{ $_shimmer_scale := printf "--shimmer-scale:%f" (.Get "scale" | default 1.30) }}

{{ $_init_delay := add -99999.9 $time_start_offset}}

{{ $speed_sign := 1 }}
{{ if lt $rawDelay 0.0 }}
	{{ $speed_sign = -1 }}
{{ end }}


{{$output := printf "<span class='%s'>" $top_css_class }}

{{- range $index, $char := $chars -}}
	{{ $delay := mul $index ($absDelay) }}
	{{ $delay = mul $delay $speed_sign  }}
	{{ $delay = add $delay $_init_delay }}
	
	{{ $_shimmer_translate := printf "--shimmer-translate:translate3D(%dpx, %dpx, %dpx)" $x $y $z }}

	{{ $_shimmer_properties_slice := slice $_shimmer_translate $_shimmer_scale $shimmer_c1 $shimmer_c2 $blur_property }}
	{{ $_shimmer_properties_slice_non_empty := complement (slice nil) (slice "") $_shimmer_properties_slice }}

	{{ $_shimmer_properties := delimit $_shimmer_properties_slice_non_empty ";" }}
	{{/*  NOTE THIS ADDS WHITESPACES!  */}}
	{{/*  INFO  https://discourse.gohugo.io/t/hugo-range-function-adds-extra-whitespace-between-spans/33219 */}}
	{{/*  <span class="wavy-text" style="animation-duration:{{$animation_time}}s; animation-delay: {{$delay | safeCSS}}s; --y-wave-translate-min:{{$min_y}}px; --y-wave-translate-max:{{$max_y}}px;">{{- $char -}}</span>  */}}
	{{if eq $char " "}}
		{{ $output = printf "%s<span style='display:inline;'> </span>" ($output | safeHTMLAttr) }}
	{{ else }}
		{{ $output = printf "%s<span style='%s;animation-duration:%fs; animation-delay:%fs;'>%s</span>" $output $_shimmer_properties $animation_time ($delay) $char }}
	{{ end }}
{{- end -}}

{{ $output = printf "%s</span>" $output }}
{{/*  To avoid whitespaces in HTML  */}}
{{ $output | safeHTML }}
