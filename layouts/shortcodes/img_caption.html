{{- /*  
Shows an image with a caption below

Arguments:
img = (string) img path.
caption = (string) Caption text. Default: ""
italic = (bool) If true, caption will be in italics. Default: true
alt = (string) Alternative text when not showing the image (Adding it improves SEO).

Usage:
{{< image_caption img="dexter.png" caption="My best friend" italic=false alt="Picture of a cute dog" >}}
*/ -}}

{{- $img_path := or (.Get "img") (.Get 0) -}}
{{- $caption := or (.Get "caption") (.Get 1) | default "" -}}
{{- $italic := or (.Get "italic") (.Get 2) | default true -}}
{{- $alt_text := or (.Get "alt") (.Get 3) | default "" -}}

{{- if not $alt_text -}}
{{- $alt_text = "Image" -}}
{{- end -}}

{{- $image_resource := or (.Page.Resources.Get $img_path) (resources.Get $img_path) -}}
{{- $img_url := $image_resource.RelPermalink -}}

{{- $tag := "span" | safeHTMLAttr -}}
{{- if $italic -}}
	{{- $tag = "em" | safeHTMLAttr -}}
{{- end -}}
<figure>
    <img src="{{- $img_url -}}" loading="lazy" width="{{$image_resource.Width}}" height="{{$image_resource.Height}}" alt="{{$alt_text}}">
    {{- /*  <img src="{{- $img_url -}}" loading="lazy" {{- partial "utils/img-attributes-from-resource.html" (dict "page" .Page "img_path" $img_path) }} alt="{{$alt_text}}">  */ -}}
    {{- /*  <{{ $tag }} style="opacity: .6;">{{- $caption -}}</{{ $tag }}>  */ -}}
	{{- if $caption -}}
		{{- $html := printf "<%s style='opacity:.6;'>%s</%s>" $tag $caption $tag -}}
		{{- $html | safeHTML -}}
	{{- end -}}
</figure>